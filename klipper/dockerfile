FROM python:3.10-slim

RUN apt-get update && apt-get install -y \
    git \
    build-essential \
    python3-dev \
    libffi-dev \
    libssl-dev \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /opt
RUN git clone https://github.com/Klipper3d/klipper.git

WORKDIR /opt/klipper
RUN pip install --no-cache-dir -r scripts/klippy-requirements.txt

WORKDIR /home/klipper/config

CMD ["python", "/opt/klipper/klippy/klippy.py", "/home/klipper/config/printer.cfg", "-l", "/home/klipper/logs/klippy.log"]
